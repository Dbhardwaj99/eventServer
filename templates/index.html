<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Event Server</title>
    <style>
      :root {
        --bg: #0b0f14;
        --card: #121826;
        --border: #1e293b;
        --title: #e2e8f0;
        --text: #cbd5e1;
        --muted: #94a3b8;
        --badge: #334155;
        --accent: #3b82f6;
        --key: #7dd3fc; --string: #a7f3d0; --number: #fca5a5; --bool: #fde68a; --null: #c4b5fd;
      }
      body.light {
        --bg: #f5f6f8;
        --card: #ffffff;
        --border: #dce1e7;
        --title: #0f172a;
        --text: #0f172a;
        --muted: #475569;
        --badge: #e5e7eb;
        --accent: #2563eb;
        --key: #0369a1; --string: #047857; --number: #b91c1c; --bool: #a16207; --null: #6d28d9;
      }
      body { margin: 0; background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      header { position: sticky; top: 0; background: color-mix(in oklab, var(--bg) 90%, transparent); padding: 12px 16px; border-bottom: 1px solid var(--border); backdrop-filter: blur(12px); z-index: 10; }
      header .row { display: flex; gap: 12px; align-items: center; justify-content: space-between; flex-wrap: wrap; }
      .status { font-size: 12px; color: var(--muted); }
      .controls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
      .left { display: flex; gap: 10px; align-items: center; }
      .nav { display: flex; gap: 8px; }
      .btn, select { background: var(--card); color: var(--text); border: 1px solid var(--border); border-radius: 10px; padding: 6px 10px; font-size: 13px; line-height: 1.2; box-shadow: 0 1px 0 rgba(0,0,0,0.05); }
      .btn { cursor: pointer; }
      .btn.primary { background: linear-gradient(to bottom, color-mix(in oklab, var(--accent) 85%, white), var(--accent)); color: white; border: 1px solid color-mix(in oklab, var(--accent) 60%, black); }
      main { padding: 16px; display: grid; gap: 12px; }
      .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
      .row2 { display: flex; align-items: baseline; justify-content: space-between; gap: 8px; margin-bottom: 8px; }
      .title { font-weight: 700; color: var(--title); font-size: 14px; }
      .badges { display: flex; gap: 6px; flex-wrap: wrap; }
      .badge { font-size: 11px; padding: 2px 6px; border-radius: 999px; background: var(--badge); color: var(--text); border: 1px solid var(--border); }
      pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; background: color-mix(in oklab, var(--card) 90%, black); border-radius: 8px; padding: 10px; border: 1px solid var(--border); overflow: auto; font-size: 12px; line-height: 1.5; }
      .j-key { color: var(--key); }
      .j-string { color: var(--string); }
      .j-number { color: var(--number); }
      .j-bool { color: var(--bool); }
      .j-null { color: var(--null); }
      .empty { text-align: center; color: var(--muted); padding: 48px 0; }
    </style>
    <script>
      function applyTheme() {
        const t = localStorage.getItem('theme') || 'dark';
        document.body.classList.toggle('light', t === 'light');
        const btn = document.getElementById('themeToggle');
        if (btn) btn.textContent = t === 'light' ? 'Dark Mode' : 'Light Mode';
      }
      window.addEventListener('DOMContentLoaded', () => {
        applyTheme();
        // Syntax highlight JSON in code blocks
        function syntaxHighlight(txt) {
          const esc = txt.replace(/&/g,'&amp;').replace(/</g,'&lt;');
          return esc.replace(/("(\\u[a-fA-F0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d+)?(?:[eE][+\-]?\d+)?)/g, m => {
            let cls = 'j-number';
            if (/^"/.test(m)) cls = /:$/.test(m) ? 'j-key' : 'j-string';
            else if (/true|false/.test(m)) cls = 'j-bool';
            else if (/null/.test(m)) cls = 'j-null';
            return '<span class="'+cls+'">'+m+'</span>';
          });
        }
        document.querySelectorAll('pre[data-json] code').forEach(code => {
          code.innerHTML = syntaxHighlight(code.textContent);
        });
      });
    </script>
  </head>
  <body>
    <header>
      <div class="row">
        <div class="left">
          <div class="title">Event Server</div>
          <div class="status">Captured requests</div>
        </div>
        <div class="controls">
          <div class="nav">
            <a class="btn" href="/events-view">Live Events</a>
            <button id="themeToggle" class="btn" onclick="localStorage.setItem('theme', (localStorage.getItem('theme')||'dark')==='light'?'dark':'light'); applyTheme();">Light Mode</button>
          </div>
          <form method="post" action="/clear" onsubmit="return confirm('Clear all logs?');">
            <button type="submit" class="btn">Clear</button>
          </form>
        </div>
      </div>
    </header>

    <main>
      {% if items and items|length > 0 %}
        {% for item in items %}
          <section class="card">
            <div class="row2">
              <div class="title">{{ item.endpoint }}</div>
              <div class="badges">
                <span class="badge">{{ item.timestamp }} IST</span>
                <span class="badge">{{ item.method }}</span>
              </div>
            </div>
            <pre data-json><code>{{ item.json_pretty }}</code></pre>
          </section>
        {% endfor %}
      {% else %}
        <div class="empty">No requests yet. Send a POST request to any endpoint.</div>
      {% endif %}
    </main>
  </body>
</html>
